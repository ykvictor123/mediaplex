<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaPlex Latino</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #141414;
            color: white;
            margin: 0;
            padding: 0;
        }
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        .media-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .media-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .media-item:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <h1 class="text-center mb-4">MediaPlex Latino</h1>
        <div id="mediaGrid" class="media-grid"></div>
    </div>

    <script>
        const TMDB_API_KEY = '708a2826cbb3c7dbd79b10c569049f54';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const TMDB_IMAGE_URL = 'https://image.tmdb.org/t/p/w500';

        const OMDB_API_KEY = 'your-omdb-api-key'; // Reemplaza con tu clave de OMDb
        const OMDB_BASE_URL = 'https://www.omdbapi.com/';

        const VID_SRC_API = 'https://vidsrc.dev/api/movies';

        const CORS_PROXY = 'https://corsproxy.io/?'; // Proxy para evitar problemas de CORS

        async function fetchMoviesFromTMDB(query) {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/search/movie?api_key=${TMDB_API_KEY}&language=es-419&query=${encodeURIComponent(query)}`);
                const data = await response.json();
                return data.results || [];
            } catch (error) {
                console.error('Error al buscar en TMDB:', error);
                return [];
            }
        }

        async function fetchOMDbMetadata(imdbId) {
            try {
                const response = await fetch(`${OMDB_BASE_URL}?apikey=${OMDB_API_KEY}&i=${imdbId}`);
                return await response.json();
            } catch (error) {
                console.error('Error al obtener datos de OMDb:', error);
                return null;
            }
        }

        async function fetchVidSrcLink(imdbId) {
            try {
                const response = await fetch(`${CORS_PROXY}${VID_SRC_API}?imdb_id=${imdbId}`);
                const data = await response.json();
                return data.data || null;
            } catch (error) {
                console.error('Error al obtener enlaces de VidSrc:', error);
                return null;
            }
        }

        function renderMovie(metadata) {
            const mediaGrid = document.getElementById('mediaGrid');
            const item = document.createElement('div');
            item.className = 'media-item';
            item.innerHTML = `
                <img src="${metadata.poster_path ? TMDB_IMAGE_URL + metadata.poster_path : 'https://via.placeholder.com/150'}" alt="${metadata.title}">
                <h5 class="text-center mt-2">${metadata.title} (${metadata.release_date ? metadata.release_date.split('-')[0] : 'N/A'})</h5>
            `;
            item.addEventListener('click', () => playMovie(metadata));
            mediaGrid.appendChild(item);
        }

        async function playMovie(metadata) {
            const imdbId = metadata.imdb_id || '';
            const vidSrcLink = await fetchVidSrcLink(imdbId);

            if (vidSrcLink && vidSrcLink.sources.length > 0) {
                const videoUrl = vidSrcLink.sources[0].url;
                window.open(videoUrl, '_blank'); // Abrir el enlace en una nueva pestaña
            } else {
                alert('No se encontraron enlaces de reproducción.');
            }
        }

        async function loadMovies() {
            const query = prompt("Ingresa el nombre de la película o serie:");
            const results = await fetchMoviesFromTMDB(query);

            if (results.length > 0) {
                results.forEach(renderMovie);
            } else {
                alert('No se encontraron resultados.');
            }
        }

        document.addEventListener('DOMContentLoaded', loadMovies);
    </script>
</body>
</html>
