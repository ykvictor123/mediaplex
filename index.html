<html><head><base href="https://www.flixhub.com">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alisson Movies - Streaming Movies and TV Shows</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body {
      background: #141414;
      font-family: 'Roboto', sans-serif;
      line-height: 1.6;
      margin: 0;
      color: #fff;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }
    header {  
      padding: 1rem 0;
      margin-bottom: 1rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .header-top {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }
    .logo {
      width: 40px;
      height: 40px;
    }
    h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #fff;
      margin: 0;
    }
    .search-container {
      max-width: 500px;
      margin: 1.5rem auto;
      position: relative;
    }
    #searchInput {
      width: 100%;
      padding: 0.8rem 1rem;
      font-size: 1rem;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      color: #fff;
      transition: all 0.2s;
    }
    #searchInput:focus {
      outline: none;
      border-color: rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.12);
    }
    #searchButton {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      padding: 0.5rem 1rem;
      background: #e50914;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    #searchButton:hover {
      background: #f40d19;
    }
    nav {
      display: flex;
      flex-direction: column;
      width: 100%;
      align-items: center;
      margin-top: 20px;
    }
    .nav-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      margin: 1rem 0;
    }
    .nav-buttons button {
      padding: 0.6rem 1.2rem;
      font-size: 0.9rem;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }
    .nav-buttons button:hover {
      background: rgba(255,255,255,0.12);
    }
    .nav-buttons button.active {
      background: #e50914;
      border-color: #e50914;
    }
    .media-section {
      margin-bottom: 40px;
    }
    .category-section {
      margin-bottom: 20px;
    }
    .category-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 0 1rem;
    }
    .category-title {
      font-size: 1.2rem;
      margin: 0;
    }
    .category-filter {
      display: flex;
      gap: 10px;
    }
    .filter-btn {
      padding: 6px 12px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }
    .filter-btn.active {
      background: #e50914;
      border-color: #e50914;
    }
    .category-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px;
    }
    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
      padding: 10px;
    }
    .media-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.2s;
      cursor: pointer;
      width: 100%;
      background: rgba(0,0,0,0.2);
    }
    .media-item img {
      width: 100%;
      height: auto;
      aspect-ratio: 2/3;
      object-fit: cover;
      display: block;
      transition: transform 0.2s;
    }
    .category-card {
      flex: 0 0 auto;
      padding: 8px 16px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .category-card:hover {
      background: rgba(255,255,255,0.12);
      transform: translateY(-2px);
    }
    .category-icon {
      font-size: 1.2rem;
    }
    .category-card h3 {
      margin: 0;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .carousel-section {
      margin-bottom: 40px;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      backdrop-filter: blur(5px);
    }
    .modal-content {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 1.5rem;
      max-width: 900px;
      width: 90%;
      margin: 30px auto;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .close {
      position: absolute;
      right: 15px;
      top: 15px;
      font-size: 24px;
      font-weight: bold;
      color: #fff;
      cursor: pointer;
      z-index: 1010;
      width: 30px;
      height: 30px;
      background: rgba(0,0,0,0.5);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .close:hover {
      background: rgba(229,9,20,0.8);
    }
    .video-container {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 Aspect Ratio */
      margin-bottom: 20px;
    }
    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 8px;
    }
    footer {
      text-align: center;
      padding: 2rem;
      margin-top: 2rem;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    .similar-media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .similar-item {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.2s;
      cursor: pointer;
    }
    .similar-item img {
      width: 100%;
      height: auto;
      aspect-ratio: 2/3;
      object-fit: cover;
      display: block;
    }
    .media-item:hover,
    .similar-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .rating-badge,
    .media-year {
      position: absolute;
      padding: 3px 6px;
      font-size: 0.8rem;
      border-radius: 4px;
      background: rgba(0,0,0,0.75);
      color: white;
    }
    .rating-badge {
      top: 5px;
      right: 5px;
    }
    .media-year {
      top: 5px;
      left: 5px;
    }
    .load-more-container {
      text-align: center;
      margin: 20px 0;
      padding: 10px;
    }
    .load-more-button {
      background: #e50914;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      opacity: 0.9;
    }
    .load-more-button:hover {
      opacity: 1;
      transform: translateY(-2px);
    }
    .load-more-button:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
    }
    .play-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px 0;
    }
    .play-button, 
    .trailer-button {
      flex: 1;
      min-width: 200px;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      background: rgba(255,255,255,0.08);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .play-button:hover,
    .trailer-button:hover {
      background: rgba(255,255,255,0.12);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .play-button.latino-server {
      background: linear-gradient(45deg, #e50914, #b20710);
    }
    .play-button.latino-server:hover {
      background: linear-gradient(45deg, #f40d19, #c90812);
    }
    .trailer-button {
      background: linear-gradient(45deg, #1a1a1a, #333);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .play-button:active,
    .trailer-button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-top">
        <svg id="logoHome" class="logo" width="60" height="60" viewBox="0 0 100 100">
          <defs>
            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#e50914"></stop>
              <stop offset="100%" stop-color="#b20710"></stop>
            </linearGradient>
          </defs>
          <circle cx="50" cy="50" r="45" fill="url(#gradient)"></circle>
          <path d="M35 30 L70 50 L35 70 Z" fill="#fff"></path>
          <circle cx="50" cy="50" r="48" fill="none" stroke="#fff" stroke-width="2" class="pulse"></circle>
        </svg>
        <h1 data-translate="FlixHub">Alisson Movies</h1>
      </div>
    </header>

    <div class="search-container">
      <input type="text" id="searchInput" placeholder="Buscar pel√≠culas o series..." data-translate="Search for movies or TV shows...">
      <button id="searchButton" data-translate="Search">Buscar</button>
    </div>

    <section class="carousel-section">
      <div class="carousel-wrapper">
        <div class="carousel">
          <!-- Carousel items will be dynamically added here -->
        </div>
      </div>
    </section>

    <section class="categories-section">
      <div class="category-header">
        <h2 class="category-title">Categor√≠as</h2>
        <div class="category-filter">
          <button id="movieCategoriesBtn" class="filter-btn active">Pel√≠culas</button>
          <button id="tvCategoriesBtn" class="filter-btn">Series</button>
        </div>
      </div>
      <div class="category-grid"></div>
    </section>

    <nav class="content-nav">
      <div class="nav-buttons">
        <button id="popularButton" data-translate="Popular">Popular</button>
        <button id="nowPlayingButton" data-translate="Now Playing">Estrenos</button>
        <button id="topRatedButton" data-translate="Top Rated">Mejor Valorados</button>
        <button id="moviesButton" data-translate="Movies">Pel√≠culas</button>
        <button id="tvShowsButton" data-translate="TV Shows">Series</button>
        <button id="languageToggle" class="language-toggle">ES</button>
      </div>
    </nav>

    <section class="media-section">
      <div id="popularMovies" class="media-grid">
        <div class="category-section movies-section" style="grid-column: 1 / -1; grid-row: 1 / 4; display: block;">
          <h2 class="category-title">üé¨ Pel√≠culas</h2>
          <div class="media-grid movies-grid"></div>
          <div class="load-more-container">
            <button id="loadMoreMovies" class="load-more-button">Cargar m√°s pel√≠culas</button>
          </div>
        </div>
        <div class="category-section tv-section" style="grid-column: 1 / -1; grid-row: 4 / 7; display: block;">
          <h2 class="category-title">üì∫ Series de TV</h2>
          <div class="media-grid tv-grid"></div>
          <div class="load-more-container">
            <button id="loadMoreTv" class="load-more-button">Cargar m√°s series</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div id="sideMenu" class="side-menu">
    <h2 id="advanced-search" data-translate="Advanced Search">B√∫squeda Avanzada</h2>
    
    <label for="country" data-translate="Country">Pa√≠s:</label>
    <select id="country" name="country">
      <option value="" data-translate="All Countries">Todos los Pa√≠ses</option>
    </select>

    <label for="genre" data-translate="Genre">G√©nero:</label>
    <select id="genre" name="genre">
      <option value="" data-translate="All Genres">Todos los G√©neros</option>
    </select>

    <label for="yearFrom" data-translate="Year From">Desde el A√±o:</label>
    <select id="yearFrom" name="yearFrom">
      <option value="">Seleccionar a√±o</option>
    </select>

    <label for="yearTo" data-translate="Year To">Hasta el A√±o:</label>
    <select id="yearTo" name="yearTo">
      <option value="">Seleccionar a√±o</option>
    </select>

    <label for="rating" data-translate="Minimum Rating">Calificaci√≥n M√≠nima:</label>
    <input type="number" id="rating" name="rating" min="0" max="10" step="0.1">

    <label data-translate="Media Type">Tipo de Contenido:</label>
    <div class="radio-group">
      <input type="radio" id="movieType" name="mediaType" value="movie" checked="">
      <label for="movieType" data-translate="Movie">Pel√≠cula</label>
      <input type="radio" id="tvType" name="mediaType" value="tv">
      <label for="tvType" data-translate="TV Show">Serie</label>
    </div>

    <label for="sortBy" data-translate="Sort By">Ordenar Por:</label>
    <select id="sortBy" name="sortBy">
      <option value="popularityDesc" data-translate="Popularity (Descending)">Popularidad (Descendente)</option>
      <option value="ratingDesc" data-translate="Rating (Descending)">Calificaci√≥n (Descendente)</option>
      <option value="yearDesc" data-translate="Year (Newest First)">A√±o (M√°s Reciente)</option>
      <option value="yearAsc" data-translate="Year (Oldest First)">A√±o (M√°s Antiguo)</option>
    </select>

    <button type="button" id="advancedSearchButton" data-translate="Search">Buscar</button>
  </div>

  <div id="playerModal" class="modal">
    <div class="modal-content">
      <span class="close">√ó</span>
      <div id="mediaInfo"></div>
    </div>
  </div>

  <div class="overlay"></div>

  <script>
    function closeModal() {
      const modal = document.getElementById('playerModal');
      const mediaInfo = document.getElementById('mediaInfo');
      const player = document.getElementById('player');
      const subtitlesOverlay = document.getElementById('subtitlesOverlay');
      const videoContainer = document.querySelector('.video-container');

      if (player) {
        player.src = '';
      }

      if (subtitlesOverlay) {
        subtitlesOverlay.innerHTML = '';
      }

      if (videoContainer) {
        videoContainer.innerHTML = `
          <iframe id="player" frameborder="0" allowfullscreen></iframe>
          <div class="player-controls">
            <button onclick="closeVideo()" class="close-video">Close Video</button>
          </div>
        `;
      }

      if (mediaInfo) {
        mediaInfo.innerHTML = '';
      }

      if (modal) {
        modal.style.display = 'none';
      }

      currentMediaId = null;
      currentServer = 'latino';
      
      const errorMessages = document.querySelectorAll('.error');
      const loadingMessages = document.querySelectorAll('.loading');
      errorMessages.forEach(el => el.remove());
      loadingMessages.forEach(el => el.remove());
    }

    document.addEventListener('DOMContentLoaded', () => {
      const closeBtn = document.querySelector('.close');
      if (closeBtn) {
        closeBtn.onclick = closeModal;
      }

      const modal = document.getElementById('playerModal');
      window.onclick = function(event) {
        if (event.target == modal) {
          closeModal();
        }
      };

      document.getElementById('loadMoreMovies')?.addEventListener('click', () => loadMoreContent('movie'));
      document.getElementById('loadMoreTv')?.addEventListener('click', () => loadMoreContent('tv'));
    });

    function closeVideo() {
      const videoContainer = document.querySelector('.video-container');
      if (videoContainer) {
        const player = document.getElementById('player');
        if (player) {
          player.src = '';
        }
        videoContainer.innerHTML = `
          <iframe id="player" frameborder="0" allowfullscreen></iframe>
          <div class="player-controls">
            <button onclick="closeVideo()" class="close-video">Close Video</button>
          </div>
        `;
      }
    }

    function constructVideoUrl(server, id, type) {
      let season = 1;
      let episode = 1;
      const seasonSelect = document.getElementById('seasonSelect');
      const episodeSelect = document.getElementById('episodeSelect');
      
      if (type === 'tv' && seasonSelect && episodeSelect) {
        season = seasonSelect.value;
        episode = episodeSelect.value;
      }

      switch (server) {
        case 'latino':
          return type === 'movie' 
            ? `https://playhublite.com/movies/${id}`
            : `https://playhublite.com/series/${id}-${season}-${episode}`;
        
        case 'server1':
          return type === 'movie'
            ? `https://vidsrc.to/embed/movie/${id}`
            : `https://vidsrc.to/embed/tv/${id}/${season}/${episode}`;
            
        case 'moviesapi':
          return type === 'movie'
            ? `https://moviesapi.club/movie/${id}` 
            : `https://moviesapi.club/tv/${id}-${season}-${episode}`;
            
        case 'vidsrc':
          return type === 'movie'
            ? `https://vidsrc.me/embed/movie?tmdb=${id}`
            : `https://vidsrc.me/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
            
        case 'vidsrcxyz':
          return type === 'movie'
            ? `https://vidsrc.xyz/embed/movie?tmdb=${id}`
            : `https://vidsrc.xyz/embed/tv?tmdb=${id}&s=${season}&e=${episode}`;
            
        default:
          return type === 'movie'
            ? `https://vidsrc.to/embed/movie/${id}`
            : `https://vidsrc.to/embed/tv/${id}/${season}/${episode}`;
      }
    }

    let currentMediaId = null;
    let previousMediaId = null;
    let previousMediaType = null;
    let currentServer = 'latino';

    const TMDB_API_KEY = '708a2826cbb3c7dbd79b10c569049f54';
    const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
    const CACHE_DURATION = 96 * 60 * 60 * 1000;

    const OPENSUBTITLES_API_URL = 'https://api.opensubtitles.com/api/v1';
    const OPENSUBTITLES_API_KEY = 'YOUR_OPENSUBTITLES_API_KEY'; 
    const USER_AGENT = 'FlixHub v1.0';

    const MOVIE_GENRES = {
      28: { name: 'Action', icon: 'üé¨' },
      12: { name: 'Adventure', icon: 'üåü' },
      16: { name: 'Animation', icon: 'üé®' },
      35: { name: 'Comedy', icon: 'üòÇ' },
      80: { name: 'Crime', icon: 'üöî' },
      99: { name: 'Documentary', icon: 'üìö' },
      18: { name: 'Drama', icon: 'üé≠' },
      10751: { name: 'Family', icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶' },
      14: { name: 'Fantasy', icon: 'üßô‚Äç‚ôÇÔ∏è' },
      36: { name: 'History', icon: 'üìú' },
      27: { name: 'Horror', icon: 'üëª' },
      10402: { name: 'Music', icon: 'üéµ' },
      9648: { name: 'Mystery', icon: 'üîç' },
      10749: { name: 'Romance', icon: '‚ù§Ô∏è' },
      878: { name: 'Science Fiction', icon: 'üöÄ' },
      10770: { name: 'TV Movie', icon: 'üì∫' },
      53: { name: 'Thriller', icon: 'üò±' },
      10752: { name: 'War', icon: '‚öîÔ∏è' },
      37: { name: 'Western', icon: 'ü§†' }
    };

    const TV_GENRES = {
      10759: { name: 'Action & Adventure', icon: 'üé¨' },
      16: { name: 'Animation', icon: 'üé®' },
      35: { name: 'Comedy', icon: 'üòÇ' },
      80: { name: 'Crime', icon: 'üöî' },
      99: { name: 'Documentary', icon: 'üìö' },
      18: { name: 'Drama', icon: 'üé≠' },
      10751: { name: 'Family', icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶' },
      10762: { name: 'Kids', icon: 'üßí' },
      9648: { name: 'Mystery', icon: 'üîç' },
      10763: { name: 'News', icon: 'üì∞' },
      10764: { name: 'Reality', icon: 'üì∑' },
      10765: { name: 'Sci-Fi & Fantasy', icon: 'üöÄ' },
      10766: { name: 'Soap', icon: 'üì∫' },
      10767: { name: 'Talk', icon: 'üí¨' },
      10768: { name: 'War & Politics', icon: '‚öîÔ∏è' },
      37: { name: 'Western', icon: 'ü§†' }
    };

    let displayedMediaIds = new Set();

    let currentMoviePage = 1;
    let currentTvPage = 1;
    let isLoadingMore = false;
    let currentMovieEndpoint = '/movie/popular';
    let currentTvEndpoint = '/tv/popular';

    let currentLanguage = 'es-419'; 
    let currentMediaType = 'movie';
    let isLoading = false;
    let advancedSearchParams = null;
    let isAdvancedSearchActive = false;

    window.currentFilter = 'all';
    window.currentGenreId = null;

    function displayCategories(type) {
      const categoryGrid = document.querySelector('.category-grid');
      categoryGrid.innerHTML = '';

      const genres = type === 'movie' ? MOVIE_GENRES : TV_GENRES;

      Object.entries(genres).forEach(([id, {name, icon}]) => {
        const categoryCard = document.createElement('div');
        categoryCard.className = 'category-card';
        categoryCard.onclick = () => filterByGenre(id, type);

        categoryCard.innerHTML = `
          <span class="category-icon">${icon}</span>
          <h3>${name}</h3>
        `;

        categoryGrid.appendChild(categoryCard);
      });
    }

    function updateCategoriesSection() {
      const movieCategoriesBtn = document.getElementById('movieCategoriesBtn');
      const tvCategoriesBtn = document.getElementById('tvCategoriesBtn');

      if (movieCategoriesBtn && tvCategoriesBtn) {
        movieCategoriesBtn.addEventListener('click', () => {
          movieCategoriesBtn.classList.add('active');
          tvCategoriesBtn.classList.remove('active');
          displayCategories('movie');
        });

        tvCategoriesBtn.addEventListener('click', () => {
          tvCategoriesBtn.classList.add('active');
          movieCategoriesBtn.classList.remove('active');
          displayCategories('tv');
        });
      }
    }

    async function filterByGenre(genreId, type) {
      try {
        const endpoint = type === 'movie' ? '/discover/movie' : '/discover/tv';
        const results = await fetchMedia(endpoint, { 
          with_genres: genreId,
          page: 1 
        });

        const grid = type === 'movie' ? 
          document.querySelector('.movies-grid') : 
          document.querySelector('.tv-grid');

        grid.innerHTML = '';
        displayedMediaIds.clear();

        if (results.length === 0) {
          grid.innerHTML = '<div class="error">No content found for this category</div>';
        } else {
          results.forEach(item => displayMediaItem(item, grid, type));
        }

        grid.scrollIntoView({ behavior: 'smooth' });

      } catch (error) {
        console.error('Error filtering by genre:', error);
        const grid = type === 'movie' ? 
          document.querySelector('.movies-grid') : 
          document.querySelector('.tv-grid');
        grid.innerHTML = '<div class="error">Error loading category content. Please try again.</div>';
      }
    }

    async function fetchSimilarContent(id, type) {
      try {
        const [similarResponse, collectionResponse] = await Promise.all([
          fetch(`${TMDB_BASE_URL}/${type}/${id}/similar?api_key=${TMDB_API_KEY}&language=${currentLanguage}`),
          type === 'movie' ? 
            fetch(`${TMDB_BASE_URL}/${type}/${id}?api_key=${TMDB_API_KEY}&language=${currentLanguage}&append_to_response=belongs_to_collection`) :
            fetch(`${TMDB_BASE_URL}/${type}/${id}?api_key=${TMDB_API_KEY}&language=${currentLanguage}`)
        ]);

        const similarData = await similarResponse.json();
        const contentData = await collectionResponse.json();
        
        let collectionItems = [];
        if (type === 'movie' && contentData.belongs_to_collection) {
          const collectionResponse = await fetch(
            `${TMDB_BASE_URL}/collection/${contentData.belongs_to_collection.id}?api_key=${TMDB_API_KEY}&language=${currentLanguage}`
          );
          const collectionData = await collectionResponse.json();
          collectionItems = collectionData.parts || [];
        }

        return {
          similar: similarData.results || [],
          collection: collectionItems
        };
      } catch (error) {
        console.error('Error fetching similar content:', error);
        return { similar: [], collection: [] };
      }
    }

    async function searchTrailer(title, type, year) {
      try {
        const YOUTUBE_API_KEY = 'YOUR_YOUTUBE_API_KEY'; 
        const searchQuery = encodeURIComponent(`${title} ${year} trailer espa√±ol latino`);
        
        const channelId = 'UCeYZvxQ9E_UXhGEk6klKxXg'; 
        let response = await fetch(
          `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&q=${searchQuery}&key=${YOUTUBE_API_KEY}&type=video&maxResults=1`
        );
        let data = await response.json();
        
        if (!data.items || data.items.length === 0) {
          response = await fetch(
            `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${searchQuery}&key=${YOUTUBE_API_KEY}&type=video&maxResults=1`
          );
          data = await response.json();
        }
        
        if (data.items && data.items.length > 0) {
          return `https://www.youtube.com/embed/${data.items[0].id.videoId}`;
        }
        
        throw new Error('No trailer found');
      } catch (error) {
        console.error('Error searching for trailer:', error);
        throw error;
      }
    }

    async function playTrailer(id, type) {
      try {
        const response = await fetch(
          `${TMDB_BASE_URL}/${type}/${id}?api_key=${TMDB_API_KEY}&language=${currentLanguage}`
        );
        const data = await response.json();
        
        const videoContainer = document.querySelector('.video-container');
        videoContainer.innerHTML = '<div class="loading">Buscando trailer...</div>';
        
        try {
          const trailerUrl = await searchTrailer(
            data.title || data.name,
            type,
            (data.release_date || data.first_air_date || '').split('-')[0]
          );
          
          videoContainer.innerHTML = `
            <iframe 
              id="player" 
              src="${trailerUrl}" 
              frameborder="0" 
              allowfullscreen>
            </iframe>
          `;
        } catch (youtubeError) {
          const videosResponse = await fetch(
            `${TMDB_BASE_URL}/${type}/${id}/videos?api_key=${TMDB_API_KEY}`
          );
          const videos = await videosResponse.json();
          
          const trailer = videos.results.find(video => 
            video.type === 'Trailer' && 
            (video.site === 'YouTube' || video.site === 'Vimeo')
          );
          
          if (trailer) {
            const trailerUrl = trailer.site === 'YouTube' 
              ? `https://www.youtube.com/embed/${trailer.key}`
              : `https://player.vimeo.com/video/${trailer.key}`;
              
            videoContainer.innerHTML = `
              <iframe 
                id="player" 
                src="${trailerUrl}" 
                frameborder="0" 
                allowfullscreen>
              </iframe>
            `;
          } else {
            throw new Error('No trailer available');
          }
        }
        
      } catch (error) {
        console.error('Error playing trailer:', error);
        const videoContainer = document.querySelector('.video-container');
        videoContainer.innerHTML = `
          <div class="error">
            No se pudo encontrar el trailer. 
            <button onclick="closeVideo()" class="retry-button">Cerrar</button>
          </div>
        `;
      }
    }

    async function playMedia(server = 'latino', id, type) {
      try {
        if (server === 'latino') {
          fetch(`${TMDB_BASE_URL}/${type}/${id}?api_key=${TMDB_API_KEY}&language=es-419`)
            .then(response => response.json())
            .then(data => {
              if (!data || data.success === false) {
                console.log('Content not available in Latino server, falling back to server1');
                playMedia('server1', id, type);
                return;
              }
              
              currentServer = server;
              const videoContainer = document.querySelector('.video-container');
              const player = document.getElementById('player');
              
              videoContainer.innerHTML = `
                <div class="loading">Cargando video...</div>
                <iframe id="player" frameborder="0" allowfullscreen></iframe>
              `;

              const newPlayer = document.getElementById('player');
              const videoUrl = constructVideoUrl(server, id, type);
              console.log('Loading video from:', videoUrl);
              
              newPlayer.onload = () => {
                const loadingDiv = videoContainer.querySelector('.loading');
                if (loadingDiv) loadingDiv.remove();
                newPlayer.style.display = 'block';
              };

              newPlayer.onerror = () => {
                console.error('Failed to load video');
                playMedia('server1', id, type);
              };

              newPlayer.src = videoUrl;
            })
            .catch(error => {
              console.error('Error checking Latino content:', error);
              playMedia('server1', id, type);
            });
        } else {
          currentServer = server;
          const videoContainer = document.querySelector('.video-container');
          const player = document.getElementById('player');
          
          videoContainer.innerHTML = `
            <div class="loading">Cargando video...</div>
            <iframe id="player" frameborder="0" allowfullscreen></iframe>
          `;

          const newPlayer = document.getElementById('player');
          const videoUrl = constructVideoUrl(server, id, type);
          
          newPlayer.onload = () => {
            const loadingDiv = videoContainer.querySelector('.loading');
            if (loadingDiv) loadingDiv.remove();
            newPlayer.style.display = 'block';
          };

          newPlayer.onerror = () => {
            console.error('Failed to load video');
            videoContainer.innerHTML = `
              <div class="error">
                Error al cargar el video. Por favor intente con otro servidor.
                <button onclick="playMedia('server1', id, type)" class="retry-button">
                  Intentar con Servidor 1
                </button>
              </div>
            `;
          };

          newPlayer.src = videoUrl;
        }

      } catch (error) {
        console.error('Error playing media:', error);
        if (server === 'latino') {
          playMedia('server1', id, type);
        } else {
          const videoContainer = document.querySelector('.video-container');
          videoContainer.innerHTML = `
            <div class="error">
              ${error.message || 'Error al cargar el video. Por favor intente otro servidor.'}
              <button onclick="playMedia('server1', '${id}', '${type}')" class="retry-button">
                Intentar con Servidor 1
              </button>
            </div>
          `;
        }
      }
    }

    async function openMediaDetails(id, type) {
      try {
        currentMediaId = id;
        previousMediaId = id;
        previousMediaType = type;
        
        const modal = document.getElementById('playerModal');
        const mediaInfo = document.getElementById('mediaInfo');
        const seasonEpisodeSelection = document.getElementById('seasonEpisodeSelection');
        
        mediaInfo.innerHTML = '<div class="loading">Loading details...</div>';
        modal.style.display = 'block';

        const response = await fetch(
          `${TMDB_BASE_URL}/${type}/${id}?api_key=${TMDB_API_KEY}&language=${currentLanguage}`
        );
        const data = await response.json();

        let tvShowSelectionHtml = '';
        if (type === 'tv') {
          tvShowSelectionHtml = `
            <div id="seasonEpisodeSelection" style="margin: 20px 0; padding: 15px; background: rgba(35,35,35,0.95); border-radius: 8px;">
              <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                  <label for="seasonSelect" style="display: block; margin-bottom: 8px;">Temporada:</label>
                  <select id="seasonSelect" style="width: 100%; padding: 8px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px;">
                    ${Array.from({length: data.number_of_seasons}, (_, i) => i + 1)
                      .map(num => `<option value="${num}">Temporada ${num}</option>`)
                      .join('')}
                  </select>
                </div>
                <div style="flex: 1; min-width: 200px;">
                  <label for="episodeSelect" style="display: block; margin-bottom: 8px;">Episodio:</label>
                  <select id="episodeSelect" style="width: 100%; padding: 8px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px;">
                    <!-- Episodes will be loaded dynamically -->
                  </select>
                </div>
                <div style="flex: 1; min-width: 200px;">
                  <label for="subtitleSelect" style="display: block; margin-bottom: 8px;">Subt√≠tulos:</label>
                  <select id="subtitleSelect" style="width: 100%; padding: 8px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px;">
                    <option value="off">Sin subt√≠tulos</option>
                    <option value="es">Espa√±ol</option>
                    <option value="en">English</option>
                  </select>
                </div>
              </div>
            </div>
          `;
        }

        const playButtonsHtml = `
          <div class="play-buttons">
            <button onclick="playMedia('latino', '${id}', '${type}')" class="play-button latino-server">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5v14l11-7z"/>
              </svg>
              Server Latino
            </button>
            <button onclick="playMedia('server1', '${id}', '${type}')" class="play-button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 14.5v-9l6 4.5-6 4.5z"/>
              </svg>
              Server 1
            </button>
            <button onclick="playMedia('moviesapi', '${id}', '${type}')" class="play-button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18 3v2h-2V3H8v2H6V3H4v18h2v-2h2v2h8v-2h2v2h2V3h-2zM8 17H6v-2h2v2zm0-4H6v-2h2v2zm0-4H6V7h2v2zm10 8h-2v-2h2v2zm0-4h-2v-2h2v2zm0-4h-2V7h2v2z"/>
              </svg>
              Server 2
            </button>
            <button onclick="playMedia('vidsrc', '${id}', '${type}')" class="play-button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.11-.9-2-2-2zm0 14H3V5h18v12z"/>
              </svg>
              Server 3
            </button>
            <button onclick="playMedia('vidsrcxyz', '${id}', '${type}')" class="play-button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8z"/>
              </svg>
              Server 4
            </button>
            <button onclick="playTrailer('${id}', '${type}')" class="trailer-button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 16.5l6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
              </svg>
              Ver Trailer
            </button>
          </div>
        `;

        let contentHtml = `
          <div class="video-container">
            <iframe id="player" frameborder="0" allowfullscreen></iframe>
            <div class="player-controls">
              <button onclick="closeVideo()" class="close-video">Close Video</button>
            </div>
          </div>

          ${tvShowSelectionHtml}

          <h2>${data.title || data.name}</h2>
          <div class="media-details-info">
            <p><strong>Rating:</strong> ‚≠ê ${data.vote_average?.toFixed(1) || 'N/A'}</p>
            <p><strong>Release Date:</strong> ${data.release_date || data.first_air_date || 'N/A'}</p>
            <p><strong>Overview:</strong> ${data.overview || 'No overview available.'}</p>
          </div>
          ${playButtonsHtml}

          <div class="similar-content-section">
            <h3>Contenido Relacionado</h3>
            <div class="similar-media-grid" id="similarContent">
              <div class="loading">Cargando contenido relacionado...</div>
            </div>
          </div>
        `;

        mediaInfo.innerHTML = contentHtml;

        fetchSimilarContent(id, type).then(({similar, collection}) => {
          const similarContentGrid = document.getElementById('similarContent');
          similarContentGrid.innerHTML = '';

          if (collection.length > 0) {
            const collectionTitle = document.createElement('h4');
            collectionTitle.textContent = 'Saga / Colecci√≥n';
            collectionTitle.style.margin = '10px 0';
            collectionTitle.style.color = '#e50914';
            similarContentGrid.appendChild(collectionTitle);

            collection.forEach(item => {
              if (item.id !== parseInt(id)) {
                const similarDiv = createSimilarItemElement(item, type);
                similarContentGrid.appendChild(similarDiv);
              }
            });
          }

          if (similar.length > 0) {
            const similarTitle = document.createElement('h4');
            similarTitle.textContent = 'T√≠tulos Similares';
            similarTitle.style.margin = '20px 0 10px 0';
            similarTitle.style.color = '#e50914';
            similarContentGrid.appendChild(similarTitle);

            similar.slice(0, 6).forEach(item => {
              const similarDiv = createSimilarItemElement(item, type);
              similarContentGrid.appendChild(similarDiv);
            });
          }

          if (collection.length === 0 && similar.length === 0) {
            similarContentGrid.innerHTML = '<p>No se encontr√≥ contenido relacionado</p>';
          }
        });

        if (type === 'tv') {
          loadEpisodes(id, 1);
          
          document.getElementById('seasonSelect').addEventListener('change', function() {
            loadEpisodes(id, this.value);
          });
        }

      } catch (error) {
        console.error('Error opening media details:', error);
        document.getElementById('mediaInfo').innerHTML = 
          '<div class="error">Error loading media details. Please try again.</div>';
      }
    }

    function createSimilarItemElement(item, type) {
      const similarDiv = document.createElement('div');
      similarDiv.className = 'similar-item';
      similarDiv.onclick = () => openMediaDetails(item.id, type);

      const posterUrl = item.poster_path ? 
        `https://image.tmdb.org/t/p/w200${item.poster_path}` :
        'path/to/placeholder-image.jpg';

      const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
      const year = (item.release_date || item.first_air_date || '').split('-')[0];

      similarDiv.innerHTML = `
        <div class="rating-badge">‚≠ê ${rating}</div>
        <div class="media-year">${year}</div>
        <img src="${posterUrl}" alt="${item.title || item.name}" loading="lazy">
        <p>${item.title || item.name}</p>
      `;

      return similarDiv;
    }

    async function loadEpisodes(showId, seasonNumber) {
      try {
        const response = await fetch(
          `${TMDB_BASE_URL}/tv/${showId}/season/${seasonNumber}?api_key=${TMDB_API_KEY}&language=${currentLanguage}`
        );
        const data = await response.json();
        
        const episodeSelect = document.getElementById('episodeSelect');
        episodeSelect.innerHTML = data.episodes
          .map(episode => `
            <option value="${episode.episode_number}">
              Episodio ${episode.episode_number}: ${episode.name}
            </option>
          `)
          .join('');

        episodeSelect.addEventListener('change', function() {
          const server = currentServer || 'latino';
          playMedia(server, currentMediaId, 'tv');
        });
      } catch (error) {
        console.error('Error loading episodes:', error);
      }
    }

    async function fetchMedia(endpoint, params = {}) {
      try {
        const response = await axios.get(`${TMDB_BASE_URL}${endpoint}`, {
          params: {
            api_key: TMDB_API_KEY,
            language: currentLanguage,
            page: params.page || 1,
            ...params
          }
        });
        
        if (response.data && response.data.results) {
          return response.data.results.filter(item => item.poster_path != null);
        }
        console.error('Invalid response format:', response.data);
        return [];
      } catch (error) {
        console.error(`Error fetching media from ${endpoint}:`, error);
        return [];
      }
    }

    async function loadMoreContent(type) {
      if (isLoadingMore) return;
      isLoadingMore = true;

      try {
        const grid = type === 'movie' ? 
          document.querySelector('.movies-grid') : 
          document.querySelector('.tv-grid');
        
        const page = type === 'movie' ? ++currentMoviePage : ++currentTvPage;
        const endpoint = type === 'movie' ? currentMovieEndpoint : currentTvEndpoint;
        
        const loadMoreButton = type === 'movie' ? 
          document.getElementById('loadMoreMovies') : 
          document.getElementById('loadMoreTv');
        loadMoreButton.textContent = 'Loading...';
        loadMoreButton.disabled = true;

        const results = await fetchMedia(endpoint, { page });

        if (results.length > 0) {
          results.forEach(item => displayMediaItem(item, grid, type));
          
          loadMoreButton.textContent = type === 'movie' ? 
            'Cargar m√°s pel√≠culas' : 
            'Cargar m√°s series';
          loadMoreButton.disabled = false;
        } else {
          loadMoreButton.textContent = 'No hay m√°s contenido';
          loadMoreButton.disabled = true;
        }

      } catch (error) {
        console.error(`Error loading more ${type} content:`, error);
        const loadMoreButton = type === 'movie' ? 
          document.getElementById('loadMoreMovies') : 
          document.getElementById('loadMoreTv');
        loadMoreButton.textContent = 'Error - Intentar de nuevo';
        loadMoreButton.disabled = false;
      }

      isLoadingMore = false;
    }

    async function fetchSubtitles(imdbId, language = 'es') {
      try {
        const response = await fetch(`${OPENSUBTITLES_API_URL}/subtitles`, {
          method: 'GET',
          headers: {
            'Api-Key': OPENSUBTITLES_API_KEY,
            'User-Agent': USER_AGENT,
            'Content-Type': 'application/json'
          },
          params: {
            imdb_id: imdbId,
            languages: language,
            order_by: 'download_count',
            order_direction: 'desc'
          }
        });
        
        const data = await response.json();
        return data.data.filter(sub => 
          sub.attributes.language === 'es-419' || 
          sub.attributes.language === 'es-ES' ||
          sub.attributes.language === 'es'
        ).slice(0, 5);
      } catch (error) {
        console.error('Error fetching subtitles:', error);
        return null;
      }
    }

    function displayMediaItem(item, container, type) {
      if (!item.poster_path) return;
      
      const mediaDiv = document.createElement('div');
      mediaDiv.className = 'media-item';
      mediaDiv.onclick = () => openMediaDetails(item.id, type);

      const posterUrl = `https://image.tmdb.org/t/p/w500${item.poster_path}`;
      const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
      const year = (item.release_date || item.first_air_date || '').split('-')[0];

      mediaDiv.innerHTML = `
        <div class="rating-badge">‚≠ê ${rating}</div>
        <div class="media-year">${year}</div>
        <img 
          src="${posterUrl}" 
          alt="${item.title || item.name}"
          loading="lazy"
        >
      `;

      if (!displayedMediaIds.has(item.id)) {
        displayedMediaIds.add(item.id);
        container.appendChild(mediaDiv);
      }
    }

    async function loadInitialContent() {
      try {
        console.log('Loading initial content...');
        currentMoviePage = 1;
        currentTvPage = 1;
        displayedMediaIds.clear();

        document.querySelector('.movies-section').style.display = 'block';
        document.querySelector('.tv-section').style.display = 'block';

        const [movies, tvShows] = await Promise.all([
          fetchMedia('/movie/popular', { page: 1 }),
          fetchMedia('/tv/popular', { page: 1 })
        ]);

        const moviesGrid = document.querySelector('.movies-grid');
        const tvGrid = document.querySelector('.tv-grid');
        moviesGrid.innerHTML = '';
        tvGrid.innerHTML = '';

        movies.forEach(movie => displayMediaItem(movie, moviesGrid, 'movie'));
        tvShows.forEach(show => displayMediaItem(show, tvGrid, 'tv'));

        const loadMoreMovies = document.getElementById('loadMoreMovies');
        const loadMoreTv = document.getElementById('loadMoreTv');
        if (loadMoreMovies) {
          loadMoreMovies.disabled = false;
          loadMoreMovies.textContent = 'Cargar m√°s pel√≠culas';
        }
        if (loadMoreTv) {
          loadMoreTv.disabled = false;
          loadMoreTv.textContent = 'Cargar m√°s series';
        }
      } catch (error) {
        console.error('Error in loadInitialContent:', error);
        document.querySelector('.movies-grid').innerHTML = 
          '<div class="error">Error loading movies. Please try again.</div>';
        document.querySelector('.tv-grid').innerHTML = 
          '<div class="error">Error loading TV shows. Please try again.</div>';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.querySelector('.movies-section').style.display = 'block';
      document.querySelector('.tv-section').style.display = 'block';

      loadInitialContent();

      updateCategoriesSection();
      displayCategories('movie'); 

      document.getElementById('moviesButton')?.addEventListener('click', function() {
        document.querySelector('.movies-section').style.display = 'block';
        document.querySelector('.tv-section').style.display = 'none';
        
        this.classList.add('active');
        document.getElementById('tvShowsButton').classList.remove('active');
      });

      document.getElementById('tvShowsButton')?.addEventListener('click', function() {
        document.querySelector('.movies-section').style.display = 'none';
        document.querySelector('.tv-section').style.display = 'block';
        
        this.classList.add('active');
        document.getElementById('moviesButton').classList.remove('active');
      });

      const navButtons = {
        'popularButton': { 
          endpoints: { movie: '/movie/popular', tv: '/tv/popular' },
          title: 'Popular'
        },
        'nowPlayingButton': { 
          endpoints: { movie: '/movie/now_playing', tv: '/tv/on_the_air' },
          title: 'Now Playing/On Air'
        },
        'topRatedButton': { 
          endpoints: { movie: '/movie/top_rated', tv: '/tv/top_rated' },
          title: 'Top Rated'
        }
      };

      Object.entries(navButtons).forEach(([buttonId, config]) => {
        document.getElementById(buttonId)?.addEventListener('click', async function() {
          document.querySelectorAll('.nav-buttons button').forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          currentMoviePage = 1;
          currentTvPage = 1;
          
          currentMovieEndpoint = config.endpoints.movie;
          currentTvEndpoint = config.endpoints.tv;

          displayedMediaIds.clear();

          try {
            const moviesGrid = document.querySelector('.movies-grid');
            const tvGrid = document.querySelector('.tv-grid');
            moviesGrid.innerHTML = '<div class="loading">Loading movies...</div>';
            tvGrid.innerHTML = '<div class="loading">Loading TV shows...</div>';

            const [movies, tvShows] = await Promise.all([
              fetchMedia(config.endpoints.movie, { page: 1 }),
              fetchMedia(config.endpoints.tv, { page: 1 })
            ]);

            moviesGrid.innerHTML = '';
            tvGrid.innerHTML = '';
            
            movies.forEach(movie => displayMediaItem(movie, moviesGrid, 'movie'));
            tvShows.forEach(show => displayMediaItem(show, tvGrid, 'tv'));

            document.getElementById('loadMoreMovies').disabled = false;
            document.getElementById('loadMoreTv').disabled = false;
            
          } catch (error) {
            console.error(`Error loading ${config.title} content:`, error);
            document.querySelector('.movies-grid').innerHTML = 
              '<div class="error">Error loading movies. Please try again.</div>';
            document.querySelector('.tv-grid').innerHTML = 
              '<div class="error">Error loading TV shows. Please try again.</div>';
          }
        });
      });

      document.getElementById('languageToggle')?.addEventListener('click', function() {
        currentLanguage = currentLanguage === 'es-419' ? 'en-US' : 'es-419';
        this.textContent = currentLanguage === 'es-419' ? 'ES' : 'EN';
        
        loadInitialContent();
      });
    });
  </script>
  <footer>
    <strong>Design by Victor</strong>
  </footer>
</body></html>